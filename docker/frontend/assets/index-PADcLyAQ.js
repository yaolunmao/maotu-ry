import{u as w,r as u,Y as I,ag as p,G as h,H as y,o as k,c as j,h as B,i as A,ae as E,ac as g}from"./index-F5mM8V04.js";import{g as M}from"./project-RGje6Uw9.js";/* empty css              */import{s as c}from"./websocket-BwnmWN4P.js";const D={__name:"index",setup(C){const _=w(),t=u("");t.value=_.query.project_id;const d=u(),l=u(),f=u(!0),m=(o,r,s,a,n)=>{if(console.log(o,r,s,a,22),o=="testRemoteControl"){g.success(`收到指令，控制${r}设备,附加消息是${n}`);const e={projectId:t.value,deviceId:s,props:[{type:"onOff",val:!a.props.state.val}]};c(e)}else o=="testAllOpen"?s.forEach(e=>{const i={projectId:t.value,deviceId:e,props:[{type:a,val:!0}]};c(i)}):o=="testAllClose"?s.forEach(e=>{const i={projectId:t.value,deviceId:e,props:[{type:a,val:!1}]};c(i)}):g.error(`未解析的指令:${o}`)};return M(t.value).then(o=>{var s,a;o.data.dataModel?(s=l.value)==null||s.setImportJson(JSON.parse(o.data.dataModel)):(a=l.value)==null||a.setImportJson({canvasCfg:{width:1920,height:1080,scale:1,color:"",img:"",guide:!0,adsorp:!0,adsorp_diff:3,transform_origin:{x:0,y:0},drag_offset:{x:0,y:0}},gridCfg:{enabled:!0,align:!0,size:10},json:[]}),f.value=!1;const r=window.location.host;d.value=new WebSocket(`ws://${r}/ws/${I()}`),d.value.onopen=function(n){console.log("websocket连接成功");const e={projectId:t.value,deviceId:11,props:[{type:"ws_state",val:!0}]};c(e)},d.value.onmessage=function(n){const e=JSON.parse(n.data);if(console.log("websocket收到消息",e),e.type=="setNodeAttr"){const i=e.msg.map(v=>({id:v.id,key:v.attr,val:v.val}));l.value.setItemAttrs(i)}else e.type=="setNodeAttrByID"?l.value.setItemAttrByID(e.msg):console.log("未定义的数据类型")},d.value.onclose=function(n){console.log("连接已断开");const e={projectId:t.value,deviceId:11,props:[{type:"ws_state",val:!1}]};c(e)}}),t.value==1?(p({title:"设备模拟",dangerouslyUseHTMLString:!0,message:`<div>请点击<a href="/ws_power_system?project_id=${t.value}" target="_blank"><strong>这里</strong></a>进行设备模拟</div>`,duration:0}),setTimeout(()=>{p({title:"设备控制",message:"B牌断路器配置了点击事件,请点击图纸上的B牌断路器查看",duration:0})},100),setTimeout(()=>{p({title:"电流与断路器同步",message:"在设备模拟页开启关闭断路器，观察电流动画",duration:0})},100)):p({title:"功能开发中敬请期待",message:"本页的实时数据暂未接入，如需查看演示请移步电力系统项目演示",duration:0}),(o,r)=>{const s=h("loading");return y((k(),j("div",null,[B(A(E),{ref_key:"MtPreviewRef",ref:l,onOnEventCallBack:m},null,512)])),[[s,f.value]])}}};export{D as default};
