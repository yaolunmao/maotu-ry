import{_ as m,a as I,u as b,r as d,H as N,I as P,o as S,c as j,h as O,i as x,a6 as s}from"./index-_GLIFr1R.js";import{s as r,g as B}from"./project-J1lw65wD.js";import{l as D,a as M,u as w}from"./svgnode-ecd8D-XT.js";import{i as y}from"./style-3JRxIzL2.js";const R={class:"webtopo-edit"},J={__name:"index",setup(k){const u=I(),a=b(),t=d(),l=d(null),i=d(""),v=d(!0),p=()=>{console.log("点击了返回按钮"),u.go(-1)},_=o=>{s.error("无权限进行此操作")},g=o=>{console.log("点击了保存按钮，可以在此处将图存到数据库",o),r({projectId:i.value,dataModel:JSON.stringify(o),thumbnail:o.thumbnail}).then(e=>{s.success("保存成功！")})},c=()=>{Promise.all([B(i.value),D({projectId:i.value})]).then(o=>{console.log(o,35),l.value={bind_device_list:o[1].data.map(e=>({bind_node_id:e.svgNodeId,bind_node_prop:e.svgNodeProp,device_id:String(e.deviceId),device_prop:e.deviceProp})),device_list:o[0].data.deviceList.map(e=>({id:String(e.deviceId),name:String(e.deviceName),prop_list:e.deviceDictList.map(n=>n)}))},t.value=o[0].data.dataModel,console.log(t,41),v.value=!1})},f=(o,e,n)=>{console.log("触发了设备绑定",o,e,n),o==1?r({projectId:i.value,dataModel:JSON.stringify(n),thumbnail:n.thumbnail}).then(()=>{M({projectId:i.value,deviceId:e.device_id,svgNodeId:e.bind_node_id,svgNodeProp:e.bind_node_prop,deviceProp:e.device_prop}).then(h=>{s.success("绑定成功"),c()})}):r({projectId:i.value,dataModel:JSON.stringify(n),thumbnail:n.thumbnail}).then(()=>{w({projectId:i.value,deviceId:e.device_id,svgNodeId:e.bind_node_id,svgNodeProp:e.bind_node_prop,deviceProp:e.device_prop}).then(h=>{s.success("解除绑定成功"),c()})})};return console.log(a.query,1414),i.value=a.query.project_id,c(),(o,e)=>{const n=N("loading");return P((S(),j("div",R,[O(x(y),{onOnReturn:p,onOnPreview:_,onOnSave:g,onOnDeviceBind:f,"data-model":t.value,"device-info":l.value},null,8,["data-model","device-info"])])),[[n,v.value]])}}},V=m(J,[["__scopeId","data-v-c1e6b6d4"]]);export{V as default};
