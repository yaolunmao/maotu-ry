import{u as w,r as l,Z as I,E as n,H as k,I as j,o as y,c as A,h,i as B,a6 as f}from"./index-_GLIFr1R.js";import{g as E}from"./project-J1lw65wD.js";import{W as N}from"./style-3JRxIzL2.js";import{s as r}from"./websocket-TU5MfD5R.js";const T={__name:"index",setup(O){const m=w(),t=l("");t.value=m.query.project_id;const v=l(null),c=l(),d=l(),p=l(!0),_=(o,s,e,i,g)=>{if(console.log(o,s,e,i,22),o=="testRemoteControl"){f.success(`收到指令，控制${s}设备,附加消息是${g}`);const a={projectId:t.value,deviceId:e,props:[{type:"onOff",val:!i.state.OnOff.default}]};r(a)}else o=="testAllOpen"?e.forEach(a=>{const u={projectId:t.value,deviceId:a,props:[{type:i,val:!0}]};r(u)}):o=="testAllClose"?e.forEach(a=>{const u={projectId:t.value,deviceId:a,props:[{type:i,val:!1}]};r(u)}):f.error(`未解析的指令:${o}`)};return E(t.value).then(o=>{v.value=JSON.parse(o.data.dataModel),p.value=!1,c.value=new WebSocket(`ws://prod-host/ws/${I()}`),c.value.onopen=function(s){console.log("websocket连接成功");const e={projectId:t.value,deviceId:11,props:[{type:"ws_state",val:!0}]};r(e)},c.value.onmessage=function(s){const e=JSON.parse(s.data);console.log("websocket收到消息",e),e.type=="setNodeAttr"?d.value.setNodeAttr(e.msg):e.type=="setNodeAttrByID"?d.value.setNodeAttrByID(e.msg):console.log("未定义的数据类型")},c.value.onclose=function(s){console.log("连接已断开");const e={projectId:t.value,deviceId:11,props:[{type:"ws_state",val:!1}]};r(e)}}),t.value==1?(n({title:"设备模拟",dangerouslyUseHTMLString:!0,message:`<div>请点击<a href="/ws_power_system?project_id=${t.value}" target="_blank"><strong>这里</strong></a>进行设备模拟</div>`,duration:0}),setTimeout(()=>{n({title:"悬浮功能",message:"A牌断路器配置了悬浮展示,请把鼠标放到图纸上的A牌断路器上查看",duration:0})},100),setTimeout(()=>{n({title:"设备控制",message:"B牌断路器配置了点击事件,请点击图纸上的B牌断路器查看",duration:0})},100),setTimeout(()=>{n({title:"电流与断路器同步",message:"在设备模拟页开启关闭断路器，观察电流动画",duration:0})},100)):n({title:"功能开发中敬请期待",message:"本页的实时数据暂未接入，如需查看演示请移步电力系统项目演示",duration:0}),(o,s)=>{const e=k("loading");return j((y(),A("div",null,[h(B(N),{ref_key:"svgPreviewRef",ref:d,"data-model":v.value,"canvas-drag":!0,onOnEventCallBack:_},null,8,["data-model"])])),[[e,p.value]])}}};export{T as default};
